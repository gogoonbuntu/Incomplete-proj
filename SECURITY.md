# 보안 가이드라인

## API 키 관리

이 프로젝트는 다양한 API와 서비스를 사용하며, 각각 고유한 API 키나 인증 정보가 필요합니다. 이러한 민감한 정보를 안전하게 관리하기 위한 가이드라인입니다.

### 환경 변수 사용

모든 API 키와 민감한 정보는 환경 변수를 통해 관리합니다:

1. **로컬 개발 환경**:
   - `.env.local` 파일에 저장 (Git에 커밋하지 않음)
   - 예제 파일 `.env.production.example`을 참고하여 설정

2. **Vercel 배포 환경**:
   - Vercel 프로젝트 설정의 환경 변수 섹션에서 설정
   - `scripts/prepare-vercel-env.js` 스크립트를 사용하여 Firebase 서비스 계정 키를 올바른 형식으로 변환

### API 키 교체 및 순환

보안을 강화하기 위해 다음 사항을 권장합니다:

1. **정기적인 키 교체**:
   - GitHub 토큰: 3-6개월마다 교체
   - Firebase 서비스 계정 키: 6개월마다 교체
   - 기타 API 키: 1년마다 교체

2. **키 노출 시 즉시 조치**:
   - 노출된 키 즉시 무효화 및 새 키 생성
   - Git 히스토리에서 민감한 정보 제거 (BFG Repo-Cleaner 등 도구 사용)

### 클라이언트/서버 측 구분

1. **클라이언트 측 키**:
   - `NEXT_PUBLIC_` 접두사 사용
   - 브라우저에 노출되어도 안전한 키만 사용
   - 필요한 최소한의 권한만 부여된 키 사용

2. **서버 측 키**:
   - `NEXT_PUBLIC_` 접두사 없이 사용
   - 브라우저에 절대 노출되지 않도록 주의
   - 서버 측 API 라우트나 서버 컴포넌트에서만 사용

## Git 보안

1. **`.gitignore` 설정**:
   - 모든 환경 변수 파일 (`.env*`)
   - 서비스 계정 키 파일
   - 로그 파일 및 임시 파일

2. **Git 히스토리 정리**:
   - 민감한 정보가 실수로 커밋된 경우 BFG Repo-Cleaner 사용
   ```bash
   brew install bfg
   bfg --replace-text sensitive-tokens.txt
   git reflog expire --expire=now --all
   git gc --prune=now --aggressive
   ```

## Vercel 배포 보안

1. **환경 변수 설정**:
   - Vercel 대시보드의 프로젝트 설정에서 환경 변수 설정
   - 민감한 환경 변수는 "암호화" 옵션 활성화

2. **Firebase 서비스 계정 키 처리**:
   - JSON 키를 문자열로 변환하여 환경 변수로 설정
   - `scripts/prepare-vercel-env.js` 스크립트 사용

3. **배포 전 확인**:
   - `npm run verify-env` 명령으로 환경 변수 검증
   - 모든 경고와 오류 해결 후 배포

## 보안 모니터링

1. **정기적인 보안 검토**:
   - 노출된 API 키 확인
   - 불필요한 권한 제거
   - 의심스러운 활동 모니터링

2. **Firebase 보안 규칙 검토**:
   - 데이터베이스 및 스토리지 보안 규칙 정기 검토
   - 최소 권한 원칙 적용

## 문제 발생 시 조치

1. **API 키 노출**:
   - 즉시 해당 키 무효화 및 새 키 생성
   - 노출 범위 및 영향 평가
   - 필요시 관련 서비스 제공업체에 연락

2. **보안 취약점 발견**:
   - 즉시 패치 적용
   - 영향 받은 사용자에게 통지
   - 재발 방지 대책 마련
